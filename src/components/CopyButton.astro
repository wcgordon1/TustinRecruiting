<button
  aria-label="Copy code"
  class="copy-button"
>
  <svg 
    xmlns="http://www.w3.org/2000/svg" 
    class="icon copy-icon" 
    width="24" 
    height="24" 
    viewBox="0 0 24 24" 
    stroke-width="2" 
    stroke="currentColor" 
    fill="none"
  >
    <path d="M8 4v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7.242a2 2 0 0 0-.602-1.43L16.083 2.57A2 2 0 0 0 14.685 2H10a2 2 0 0 0-2 2z" />
    <path d="M16 18v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2" />
  </svg>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon check-icon hidden"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    stroke-width="2"
    stroke="currentColor"
    fill="none"
  >
    <path d="M5 12l5 5l10 -10" />
  </svg>
</button>

<script>
  function updateCopyButtons() {
    document.querySelectorAll('pre').forEach((block) => {
      if (!block.querySelector('.copy-button-wrapper')) {
        // Create wrapper div
        const wrapper = document.createElement('div');
        wrapper.className = 'copy-button-wrapper relative w-full';
        
        // Wrap the pre element
        block.parentNode.insertBefore(wrapper, block);
        wrapper.appendChild(block);
        
        // Create button
        const button = document.createElement('button');
        button.className = 'absolute -bottom-4 right-2 p-2 bg-slate-900 rounded-lg hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-400 text-white shadow-lg';
        button.innerHTML = `
          <svg class="copy-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
          </svg>
          <svg class="check-icon w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        `;
        
        wrapper.appendChild(button);
        
        button.addEventListener('click', async () => {
          const code = block.querySelector('code')?.innerText || '';
          await navigator.clipboard.writeText(code);
          
          const copyIcon = button.querySelector('.copy-icon');
          const checkIcon = button.querySelector('.check-icon');
          
          copyIcon?.classList.add('hidden');
          checkIcon?.classList.remove('hidden');
          
          setTimeout(() => {
            copyIcon?.classList.remove('hidden');
            checkIcon?.classList.add('hidden');
          }, 2000);
        });
      }
    });
  }

  // Initial setup
  updateCopyButtons();

  // Update on dynamic content changes
  document.addEventListener('astro:after-swap', updateCopyButtons);
</script>

<style>
  :global(pre) {
    margin-bottom: 2rem !important;
  }

  .copy-button {
    position: absolute;
    right: 0.5rem;
    top: 0.5rem;
    padding: 0.5rem;
    border-radius: 0.5rem;
    background-color: #0f172a;
    color: white;
    cursor: pointer;
    display: none;
  }
  
  /* Show button on pre hover */
  :global(pre:hover) .copy-button {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .copy-button:hover {
    background-color: #1e293b;
  }
  
  .icon {
    stroke: currentColor;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
    width: 1.25rem;
    height: 1.25rem;
  }
  
  .hidden {
    display: none;
  }
</style> 